// Generated by BUCKLESCRIPT VERSION 3.1.5, PLEASE EDIT WITH CARE
'use strict';

var Curry = require("bs-platform/lib/js/curry.js");
var Belt_Map = require("bs-platform/lib/js/belt_Map.js");
var Caml_obj = require("bs-platform/lib/js/caml_obj.js");
var Belt_List = require("bs-platform/lib/js/belt_List.js");
var Belt_MapString = require("bs-platform/lib/js/belt_MapString.js");
var Belt_SetString = require("bs-platform/lib/js/belt_SetString.js");

function sortBy(list, func) {
  return Belt_List.map(Belt_List.sort(Belt_List.map(list, (function (item) {
                        return /* tuple */[
                                Curry._1(func, item),
                                item
                              ];
                      })), Caml_obj.caml_compare), (function (prim) {
                return prim[1];
              }));
}

function canonicalizeOutputConnection(graph, dependencies, connectionSink) {
  var match = Belt_Map.get(graph[/* connections */0], connectionSink);
  if (match) {
    var node = match[0][/* node */0];
    if (node) {
      var nodeID = node[0];
      var match$1 = Belt_MapString.getExn(graph[/* nodes */1], nodeID);
      if (match$1) {
        var match$2 = match$1[0];
        var dependency = Belt_MapString.getExn(dependencies, match$2[/* definitionID */1]);
        return /* OutputOrderingNode */[/* record */[
                  /* contentID */dependency[/* contentID */0],
                  /* kind */match$2[/* kind */0],
                  /* children */Belt_List.map(dependency[/* inputOrdering */1], (function (nibID) {
                          return canonicalizeOutputConnection(graph, dependencies, /* record */[
                                      /* node : NodeConnection */[nodeID],
                                      /* nib : NibConnection */[nibID]
                                    ]);
                        }))
                ]];
      } else {
        return /* OutputOrderingReference */2;
      }
    } else {
      return /* OutputOrderingInput */1;
    }
  } else {
    return /* OutputOrderingDisconnected */0;
  }
}

function canonicalizeOutput(graph, dependencies, nibID) {
  return canonicalizeOutputConnection(graph, dependencies, /* record */[
              /* node : GraphConnection */0,
              /* nib : NibConnection */[nibID]
            ]);
}

function getOutputOrdering(graph, dependencies) {
  var match = Belt_SetString.size(graph[/* outputs */3]) <= 1;
  if (match) {
    return Belt_SetString.toList(graph[/* outputs */3]);
  } else {
    return sortBy(Belt_SetString.toList(graph[/* outputs */3]), (function (param) {
                  return canonicalizeOutput(graph, dependencies, param);
                }));
  }
}

exports.sortBy = sortBy;
exports.canonicalizeOutputConnection = canonicalizeOutputConnection;
exports.canonicalizeOutput = canonicalizeOutput;
exports.getOutputOrdering = getOutputOrdering;
/* No side effect */
